{{/* TODO: Make Open Graph properties configurable and editable */}}

{{/* Adding a default image for og:image */}}
{{- $cover := resources.Get "cover.png" }}
{{/* Output nothing to publish the resource. */}}
{{- if and (not (os.FileExists "static/cover.png")) $cover }}
{{- if eq $cover.RelPermalink "" }}{{ end }}
{{- else }}
{{- warnf "[Hugo SEO] Missing default image for og:image - assets/cover.png does not exist. Use a high-quality image with dimensions of at least 1200 x 630 pixels, while keeping the file size under 8 MB." }}
{{- end }}
{{- if not (in .Site.Params.images "cover.png") }}
{{- warnf "[Hugo SEO] Missing default image for og:image - Add 'images: ['cover.png']' to your hugo.toml" }}
{{- end}}

{{/* Based on: https://github.com/gohugoio/hugo/blob/master/tpl/tplimpl/embedded/templates/opengraph.html */}}
<meta property="og:title" content="{{ .Title }}">
<meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{if .IsPage}}{{ .Summary }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}{{ end }}">
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">

{{- $images := partial "_funcs/get-page-images" . -}}
{{- range first 6 $images -}}
  <meta property="og:image" content="{{ .Permalink }}">
{{- end -}}

{{- if .IsPage }}
{{- $iso8601 := "2006-01-02T15:04:05-07:00" -}}
<meta property="article:section" content="{{ .Section }}">
{{ with .PublishDate }}<meta property="article:published_time" {{ .Format $iso8601 | printf "content=%q" | safeHTMLAttr }}>{{ end }}
{{ with .Lastmod }}<meta property="article:modified_time" {{ .Format $iso8601 | printf "content=%q" | safeHTMLAttr }}>{{ end }}
{{- end -}}

{{- with .Params.audio }}<meta property="og:audio" content="{{ . }}">{{ end }}
{{- with .Params.locale }}<meta property="og:locale" content="{{ . }}">{{ end }}
{{- with .Site.Params.title }}<meta property="og:site_name" content="{{ . }}">{{ end }}
{{- with .Params.videos }}{{- range . }}
<meta property="og:video" content="{{ . | absURL }}">
{{ end }}{{ end }}

{{- /* If it is part of a series, link to related articles */}}
{{- $permalink := .Permalink }}
{{- $siteSeries := .Site.Taxonomies.series }}
{{- if $siteSeries }}
{{ with .Params.series }}{{- range $name := . }}
  {{- $series := index $siteSeries ($name | urlize) }}
  {{- range $page := first 6 $series.Pages }}
    {{- if ne $page.Permalink $permalink }}<meta property="og:see_also" content="{{ $page.Permalink }}">{{ end }}
  {{- end }}
{{ end }}{{ end }}
{{- end }}

{{- /* Deprecate site.Social.facebook_admin in favor of site.Params.social.facebook_admin */}}
{{- $facebookAdmin := "" }}
{{- with site.Params.social }}
  {{- if reflect.IsMap . }}
    {{- $facebookAdmin = .facebook_admin }}
  {{- end }}
{{- else }}
  {{- with site.Social.facebook_admin }}
    {{- $facebookAdmin = . }}
    {{- warnf "The social key in site configuration is deprecated. Use params.social.facebook_admin instead." }}
  {{- end }}
{{- end }}

{{- /* Facebook Page Admin ID for Domain Insights */}}
{{ with $facebookAdmin }}<meta property="fb:admins" content="{{ . }}">{{ end }}
